---
title: 杂项笔记
date: "2019-12-201T22:22:22.169Z"
path:  "/other-note"
tags:
   - web
---

## UML

* 单向关联: 带箭头的直线
* 依赖关系: 带箭头的虚线
* 继承关系: 带空心三角形的直线 (是一个...)
* 接口实现关系: 带空心三角形的虚线 (实现了...)

## 实际应用
* 内存泄漏
  * 表现，流量高峰过后，内存使用量呈现阶梯增长，每次增长量不大，难以排查
  * 排查方法，保留长时间运行的云实例
    1. 查看GC日志，分析FullGC后老年代的变化
    2. jmap导出内存dump，scp到本地，使用jvisualvm查看堆中对象最多的是Node
  * 查看代码，使用到HashMap作DAO缓存，错误地使用了key值使得map大小不断增长

* 动态扩容期间请求失败
  * 表现，动态扩容/缩容前后，失败请求占比增加
  * 排查：使用全链路追踪pinpoint， 发现仍然有一部分请求发送到已经关闭的容器
  * 解决：workaround-使用Hystrix实现降级， 考虑使用spring-cloud的eureka做服务发现
  * 最终解决，靠底层框架优化 - 先切流量后关闭容器

* 高并发下如何保证快速响应
  * 缓存： jvm堆缓存，redis缓存
    * redis缓存热点数据不设过期时间，靠后台定时任务实现刷新，（允许短时间不一致），防止缓存击穿
    * 非热点数据过期时间保证随机性，防止缓存雪崩
    * 非热点数据在一定条件下可转化为热点数据
  * 降级：使用Hystrix实现
