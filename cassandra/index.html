<!DOCTYPE html>
 <html><head><link rel="shortcut icon" href="https://klxd.github.io/note-site/favicon.ico"/><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/note-site/component---src-layouts-index-js-4c7570a1cc769e167041.js" as="script"/><link rel="preload" href="/note-site/component---src-templates-blog-post-js-064c2d09fdcff2a86a1d.js" as="script"/><link rel="preload" href="/note-site/path---cassandra-99b6b647afc911cd45f5.js" as="script"/><link rel="preload" href="/note-site/app-7ee943b71d5b57be72a0.js" as="script"/><link rel="preload" href="/note-site/commons-f0ec8ca84bddf71c806c.js" as="script"/><script id="webpack-manifest">
            //<![CDATA[
            window.webpackManifest = {"15178676390636814000":"app-7ee943b71d5b57be72a0.js","6502461027731969000":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","7065993314207131000":"component---src-templates-blog-post-js-064c2d09fdcff2a86a1d.js","8920819121031977000":"component---src-templates-tag-route-js-5448f45d6781dec0165a.js","3839412732901535000":"component---src-components-game-2048-js-3233febbcc5d440be41d.js","2345137460201621000":"component---src-pages-index-js-42be19c5363ff9dd624f.js","12835270051674753000":"component---src-pages-tags-js-b120b43d67ae240332d2.js","3954140758598355500":"path----557518bd178906f8d58a.js","13784418321228782000":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","17495583139258513000":"path---about-this-site-72b842decac878256c01.js","635518864555896600":"path---java-classloader-8981635c455968ef6a4c.js","10660064599783924000":"path---blog-with-gatsby-6f5af31805ea8f9ca11e.js","8144719420280132000":"path---hi-folks-5baec231f11b8d35805c.js","16145541147963748000":"path---markdown-learning-54ce7d334504132474de.js","16026867243005362000":"path---code-highlight-304fe12530c731c2ee61.js","6651855161709604000":"path---encoding-8eec6cf3bbb9693d8326.js","5979705947894877000":"path---java-array-list-30f2a30bbe28084cc027.js","18126458759721290000":"path---leetcode-55072b1fada3e4871272.js","14935930947158213000":"path---java-array-deque-c97c8d99801686d3a5e5.js","17443855456295041000":"path---java-linked-list-9bb35b067950de6bb161.js","2844489743973785600":"path---java-collection-framework-60fee7d36cbe6f82476f.js","13284927628698448000":"path---sql-table-join-3955d894ec93d6a191e8.js","4400958211773590500":"path---java-hash-table-617f1c2bbe99107e5032.js","16513549679550345000":"path---java-concurrent-hash-map-9f0055adedf2b70a633f.js","5276986228162747000":"path---java-tree-map-ccee155b45dc23ca1394.js","6225238164750303000":"path---java-linked-hash-map-080e12b65ad0a8a29513.js","4982180573294444000":"path---java-priority-queue-29ca8e48792aebf04e8b.js","14194555530695092000":"path---java-serialization-82643d6ce5df7132f4cc.js","14317612983713708000":"path---java-thread-511afbdf93b559f02dec.js","11283977664076340000":"path---java-lock-aa3cfa981f9c36b39c1b.js","12590616335811600000":"path---java-copy-on-write-array-list-94531df76ea281f19d72.js","11402648288945498000":"path---java-memory-model-a745658495c249f86af8.js","16820207139262534000":"path---java-thread-pool-6f68b02950161e1e7a1d.js","10420783750355646000":"path---java-thread-local-b64779f7c0a8592f25b7.js","8034362812816101000":"path---java-runtime-memory-c49bb7b79202794cbd62.js","8372970106469668000":"path---back-to-top-button-1fb4857629c35ca38c8b.js","267997699225971620":"path---java-static-vs-transient-039092f7c9ef7d9c028b.js","13166383532613306000":"path---micro-service-eebb27b710f4f22c86bc.js","3002031349668452000":"path---kafka-a4dfc83c4c03fd895199.js","8483082805523461000":"path---cassandra-99b6b647afc911cd45f5.js","4249768654350922000":"path---new-in-java-9-ac8b3117b4d97a093339.js","13023780024802353000":"path---tags-web-f1126dea6d0e9138e0a3.js","10182997739304628000":"path---tags-java-c89560159c22b62643b5.js","10550298781227196000":"path---tags-jvm-d9bbf950cf2265c49159.js","10868464433361236000":"path---tags-mock-f77acc6922d721f67463.js","3028396222034269000":"path---tags-remark-ed368dbc68a206c4f5a2.js","2998820046695644700":"path---tags-markdown-6b705bf73ae8b2a22d7c.js","8653037115290970000":"path---tags-prism-js-94c57e5f7041a4fed8da.js","9400156046315106000":"path---tags-encoding-d73e34868f8c928077f9.js","12678663474199468000":"path---tags-java-collection-framework-73f57af863401a5ed09b.js","10049340530526904000":"path---tags-leetcode-48303bd7d05a60dd1c60.js","13426925261089182000":"path---tags-sql-684d69e0fdc898300cf4.js","12517393503123409000":"path---tags-serialization-f9aab32f272c087bc0e8.js","4412887831933620700":"path---tags-javascript-d00b6889ffd7695adb33.js","8922948252576328000":"path---tags-architecture-1355c0e8f502e839c0bd.js","9580800669513587000":"path---tags-middleware-945bc5390e10f8328c6d.js","468946312812313200":"path---tags-kafka-c8f9eac2ad46b795e7d5.js","3327384682858550300":"path---tags-database-f137bbf5200a8f6dcc48.js","13685109203999515000":"path---games-2048-a0e39f21c11f6a62c5ab.js","9347362237655822000":"path---index-e4433451eb08ae92fc55.js","3650512264882278400":"path---tags-deadb89395e61e4fda44.js","7489246917808536000":"component---src-layouts-index-js-4c7570a1cc769e167041.js"}
            //]]>
            </script><title data-react-helmet="true">Cassandra基础知识 | Note Site</title><script>
  !function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",[
  "/note-site/commons-f0ec8ca84bddf71c806c.js","/note-site/app-7ee943b71d5b57be72a0.js","/note-site/path---cassandra-99b6b647afc911cd45f5.js","/note-site/component---src-templates-blog-post-js-064c2d09fdcff2a86a1d.js","/note-site/component---src-layouts-index-js-4c7570a1cc769e167041.js"
])
  </script><style id="gatsby-inlined-css">.tag-component{display:inline-block;transition:all .4s;border:1px solid #ccc;border-radius:1020px;padding:3px 10px;margin-bottom:5px;margin-right:4px;font-size:12px;line-height:1.5;color:#5a5a5a;text-decoration:none;white-space:nowrap}.tag-component:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.tag-component .tag-name{color:#5a5a5a}.tag-component .tag-count{background:#259;opacity:.85;top:0;padding:1px 5px;color:#fff;font-size:10px;display:inline-block;font-weight:700;line-height:1;text-align:center;white-space:nowrap;border-radius:10px;margin-left:4px}.blog-post-template{background-color:#fff;padding:16px;width:1000px}.blog-post-template .header-line{display:flex;justify-content:space-between}.blog-post-template .header-line .header-text{color:#333;font-size:2em;font-weight:700;line-height:35px}.blog-post-template .header-line .header-date{font-size:.9em}.blog-post-template .post-tags{padding-top:10px;padding-bottom:20px}.tag-route-template{background-color:#fff;padding:16px;width:1000px}.tag-route-template .tag-header-panel{padding-bottom:10px;border-bottom:1px solid #ccc}.tag-route-template .tag-content-list{padding-top:10px}.button-component{display:inline-block;background:#0f88eb;height:32px;color:#fff;border:1px solid #0f88eb;font-size:14px;padding:0 14px;text-align:center;cursor:pointer;border-radius:3px;outline:none}.button-component:hover{background-color:#0d79d1}.game-2048{background-color:#fff;padding:16px;width:1000px;display:flex;flex-direction:column;align-items:center}.game-2048 .header-container{display:flex;justify-content:space-between;width:477px;margin-bottom:20px}.game-2048 .header-container .header-text{color:#776e65;font-weight:700;font-size:74px;line-height:66px}.game-2048 .header-container .button-container{display:flex;justify-content:space-between}.game-2048 .header-container .button-container .button-component{font-weight:700;background:#8f7a66;border-color:#8f7a66}.game-2048 .grid-container{display:flex;flex-flow:column;justify-content:center;width:477px;height:477px;background:#bbada0;border-radius:6px}.game-2048 .grid-row{display:flex;justify-content:center;margin-bottom:15px}.game-2048 .grid-row:last-child{margin-bottom:0}.game-2048 .grid-cell{display:flex;justify-content:center;align-items:center;height:100px;width:100px;background-color:hsla(30,37%,89%,.34902);border-radius:3px;font-size:55px;font-weight:700;line-height:98px;color:#776e65;font-family:Clear Sans,Helvetica Neue,Arial,sans-serif;margin-right:15px}.game-2048 .grid-cell:last-child{margin-right:0}.game-2048 .tile-2{background:#eee4da}.game-2048 .tile-2,.game-2048 .tile-4{box-shadow:0 0 30px 10px hsla(47,84%,70%,0),inset 0 0 0 1px hsla(0,0%,100%,0)}.game-2048 .tile-4{background:#ede0c8}.game-2048 .tile-8{color:#f9f6f2;background:#f2b179}.game-2048 .tile-16{color:#f9f6f2;background:#f59563}.game-2048 .tile-32{color:#f9f6f2;background:#f67c5f}.game-2048 .tile-64{color:#f9f6f2;background:#f65e3b}.game-2048 .tile-128{color:#f9f6f2;background:#edcf72;box-shadow:0 0 30px 10px hsla(47,84%,70%,.2381),inset 0 0 0 1px hsla(0,0%,100%,.14286);font-size:45px}@media screen and (max-width:520px){.game-2048 .tile-128{font-size:25px}}.game-2048 .tile-256{color:#f9f6f2;background:#edcc61;box-shadow:0 0 30px 10px hsla(47,84%,70%,.31746),inset 0 0 0 1px hsla(0,0%,100%,.19048);font-size:45px}@media screen and (max-width:520px){.game-2048 .tile-256{font-size:25px}}.game-2048 .tile-512{color:#f9f6f2;background:#edc850;box-shadow:0 0 30px 10px hsla(47,84%,70%,.39683),inset 0 0 0 1px hsla(0,0%,100%,.2381);font-size:45px}@media screen and (max-width:520px){.game-2048 .tile-512{font-size:25px}}.game-2048 .tile-1024{color:#f9f6f2;background:#edc53f;box-shadow:0 0 30px 10px hsla(47,84%,70%,.47619),inset 0 0 0 1px hsla(0,0%,100%,.28571);font-size:35px}@media screen and (max-width:520px){.game-2048 .tile-1024{font-size:15px}}.game-2048 .tile-2048{color:#f9f6f2;background:#edc22e;box-shadow:0 0 30px 10px hsla(47,84%,70%,.55556),inset 0 0 0 1px hsla(0,0%,100%,.33333);font-size:35px}@media screen and (max-width:520px){.game-2048 .tile-2048{font-size:15px}}.game-2048 .tile-super{color:#f9f6f2;background:#3c3a32;font-size:30px}@media screen and (max-width:520px){.game-2048 .tile-super{font-size:10px}}.card-component .dot{display:block;color:#fff;background:red;position:absolute;font-size:10px;border-radius:1020px;box-shadow:0 15px 30px 0 rgba(0,0,0,.15);padding:1px 6px 2px;z-index:50;right:5px;top:5px}.main-page .main-container{display:flex;align-items:flex-start;justify-content:center}.main-page .main-container .main-content{margin-right:10px;width:700px}.main-page .main-container .right-side-bar{padding:10px 0 10px 10px;width:290px;line-height:2;background:#fff;border-radius:2px;box-shadow:0 1px 3px rgba(0,0,0,.1)}.main-page .post-item{padding:16px 20px;background:#fff;border-radius:2px;margin-bottom:10px}.main-page .post-header-row{display:flex;justify-content:space-between}.main-page .post-header{font-weight:600;padding-bottom:4px;line-height:1.6;font-size:18px}.main-page .post-date{font-size:80%}.main-page .post-excerpt{margin-bottom:0}.tags-page{background-color:#fff;padding:16px;width:1000px}.shelter-component{z-index:100;position:fixed;min-width:1032px;width:100%;left:0;top:0;background:#fff;overflow:hidden;box-shadow:0 1px 3px 0 rgba(0,34,77,.1)}.shelter-component .shelter-inner{display:flex;align-items:center;width:1000px;padding:0 16px;height:52px;margin:0 auto}.shelter-component .header-text{text-decoration:none;font-size:20px;font-weight:700}.shelter-component .navigation{display:flex;width:160px;justify-content:space-between;margin-left:27px}.shelter-component .navigation a{text-decoration:none;font-size:16px;color:#999}.shelter-component .navigation :hover{color:#259}.shelter-component .user-info{flex:1;display:flex;justify-content:flex-end}.corner-container{position:fixed;bottom:12px;right:12px}.corner-container .corner-button{background:#fff;border-radius:4px;width:40px;height:40px;border:none;color:#8590a6;cursor:pointer;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.1);box-shadow:0 1px 3px rgba(0,0,0,.1)}.corner-container .corner-button:hover{background:#d5dbe7}.corner-container .corner-button:focus{outline:none}code[class*=language-],pre[class*=language-]{float:left;color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-top:0;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.important,.token.regex{color:#d88489}.language-css .token.string,.style .token.string{color:#a2466c}.token.important{font-weight:400}.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.namespace{opacity:.7}.token.cr:before,.token.lf:before,.token.tab:not(:empty):before{color:#e0d7d1}blockquote{margin:1.6rem 1.6rem 1.6rem 0;padding:0 0 0 .8rem;border-left:.4rem solid rgba(46,46,46,.1);color:rgba(46,46,46,.8);font-style:italic}.gatsby-highlight{background:#272822;border-radius:.15rem;margin-top:0;margin-bottom:1.2rem;padding:1.2rem;overflow:auto}.gatsby-highlight-code-line{background:hsla(24,20%,50%,.08);display:block;margin-left:-1.2rem;margin-right:-1.2rem;padding-right:1.2rem;padding-left:.9rem;border-left:.3rem solid #3f87a6}.gatsby-highlight::-webkit-scrollbar{width:.8rem;height:.8rem;background-color:#f5f5f5}.gatsby-highlight::-webkit-scrollbar-track{background-color:#f5f5f5}.gatsby-highlight::-webkit-scrollbar-thumb{border-radius:0 0 .25rem .25rem;background-color:#555}a{color:#259}body{font-family:-apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;text-rendering:optimizeLegibility;background:#f3f3f3;line-height:1.67;font-size:15px}.common-container{display:flex;justify-content:center;overflow:hidden;margin-top:62px;min-width:1000px;margin-left:16px;margin-right:16px}</style></head><body><div id="___gatsby"><div data-reactroot="" data-reactid="1" data-react-checksum="-123605807"><div class="shelter-component" data-reactid="2"><div class="shelter-inner" data-reactid="3"><a class="header-text" href="/note-site/" data-reactid="4">Note Site</a><div class="navigation" data-reactid="5"><a href="/note-site/" data-reactid="6">首页</a><a href="/note-site/tags" data-reactid="7">标签</a><a href="/note-site/games/2048" data-reactid="8">游戏</a></div><div class="user-info" data-reactid="9"><a href="https://github.com/klxd/note-site" data-reactid="10"><svg fill="currentColor" viewBox="0 0 40 40" width="24" height="24" data-reactid="11"><path d="m20 0c-11 0-20 9-20 20 0 8.8 5.7 16.3 13.7 19 1 0.2 1.3-0.5 1.3-1 0-0.5 0-2 0-3.7-5.5 1.2-6.7-2.4-6.7-2.4-0.9-2.3-2.2-2.9-2.2-2.9-1.9-1.2 0.1-1.2 0.1-1.2 2 0.1 3.1 2.1 3.1 2.1 1.7 3 4.6 2.1 5.8 1.6 0.2-1.3 0.7-2.2 1.3-2.7-4.5-0.5-9.2-2.2-9.2-9.8 0-2.2 0.8-4 2.1-5.4-0.2-0.5-0.9-2.6 0.2-5.3 0 0 1.7-0.5 5.5 2 1.6-0.4 3.3-0.6 5-0.6 1.7 0 3.4 0.2 5 0.7 3.8-2.6 5.5-2.1 5.5-2.1 1.1 2.8 0.4 4.8 0.2 5.3 1.3 1.4 2.1 3.2 2.1 5.4 0 7.6-4.7 9.3-9.2 9.8 0.7 0.6 1.4 1.9 1.4 3.7 0 2.7 0 4.9 0 5.5 0 0.6 0.3 1.2 1.3 1 8-2.7 13.7-10.2 13.7-19 0-11-9-20-20-20z" data-reactid="12"></path></svg></a></div></div></div><div class="common-container" data-reactid="13"><div class="blog-post-template" data-reactid="14"><!-- react-empty: 15 --><div class="header-line" data-reactid="16"><div class="header-text" data-reactid="17">Cassandra基础知识</div><div class="header-date" data-reactid="18">November 29, 2017</div></div><div class="post-tags" data-reactid="19"><a class="tag-component" href="/note-site/tags/middleware/" data-reactid="20"><span class="tag-name" data-reactid="21">middleware</span><!-- react-text: 22 --><!-- /react-text --></a><a class="tag-component" href="/note-site/tags/database/" data-reactid="23"><span class="tag-name" data-reactid="24">database</span><!-- react-text: 25 --><!-- /react-text --></a></div><div data-reactid="26"><p>使用Cassandra已经有一段时间了,但是平时使用的都是公司内部封装好的接口,对Cassandra的特性并不会暴露太多,
现在在这里总结一下.</p>
<h2>ACID</h2>
<ul>
<li>
<p>原子性(Atomic)</p>
<ul>
<li>执行一个语句时,事务中的每个更新都必须成功才能称为成功</li>
</ul>
</li>
<li>
<p>一致性(Consistent)</p>
<ul>
<li>数据必须从一个正确的状态转移到另一个正确的状态</li>
</ul>
</li>
<li>
<p>隔离性(Isolated)</p>
<ul>
<li>并发执行的事务不应该彼此依赖</li>
</ul>
</li>
<li>
<p>持久性(Durable)</p>
<ul>
<li>一旦一个事务成功完成,变更就不再丢失</li>
</ul>
</li>
</ul>
<h2>CAP理论</h2>
<ul>
<li>
<p>一致性(Consistent)</p>
<ul>
<li>对于所有的数据库客户端使用同样的查询都可以得到同样的结果,
即使是有并发更新的时候也是如此</li>
</ul>
</li>
<li>
<p>可用性(Availability)</p>
<ul>
<li>所有的数据库客户端总是可以读写数据</li>
</ul>
</li>
<li>
<p>分区耐受性(Partition Tolerance)</p>
<ul>
<li>数据库可以分散到多台机器上,即使发生网络故障,被分成多个分区,
依然可以提供服务
CAP理论:对于任意给定的系统,只能强化这三个特性中的两个.</li>
</ul>
</li>
<li>
<p>CA</p>
<ul>
<li>主要支持一致性和可用性,很可能使用了两阶段提交的分布式事务,如果网络
发生分裂,那么系统可能停止响应</li>
<li>关系型数据库,MySQL,Postgres</li>
</ul>
</li>
<li>
<p>CP</p>
<ul>
<li>主要支持一致性和分区耐受性,通过设置数据分片来提升可扩展性,数据将保持
一致性,但是如果有节点发生故障,仍有部分数据不可用</li>
<li>MongoDB,HBase,Redis</li>
</ul>
</li>
<li>
<p>AP</p>
<ul>
<li>主要支持可用性和分区耐受性,系统可能返回不太精确的数据,但是系统将始终
可用,即使网络发生分区的时候也是如此</li>
<li>亚马逊Dynamo的衍生品,Cassandra</li>
</ul>
</li>
</ul>
<h2>BASE模型</h2>
<ul>
<li>Basically Available: 基本可用,允许分区失败</li>
<li>Soft state: 软状态,接收一段时间的状态不同步</li>
<li>Eventually consistent: 最终一致,保证最终数据的状态是一致的</li>
</ul>
<h2>Cassandra与RDB的对比</h2>
<table>
<thead>
<tr>
<th align="right">RDB</th>
<th align="left">column1</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">database</td>
<td align="left">keyspace</td>
</tr>
<tr>
<td align="right">table</td>
<td align="left">column family</td>
</tr>
<tr>
<td align="right">primary key</td>
<td align="left">row key</td>
</tr>
<tr>
<td align="right">column name</td>
<td align="left">column name/key</td>
</tr>
<tr>
<td align="right">column value</td>
<td align="left">column value</td>
</tr>
</tbody>
</table>
<ul>
<li>Cassandra没有引用完整性,因而没有join的概念和联级删除的概念</li>
<li>无法自由地对列进行搜索(SQL中的where语句)</li>
<li>RDB先对数据进行建模,然后写查询方法;Cassandra应先定义好查询,然后围绕查询来组织数据</li>
<li>Cassandra中没有update查询</li>
<li>不支持服务端事务,必须手工回滚</li>
</ul>
<h2>Cassandra的数据模型</h2>
<ul>
<li>
<p>集群(cluster): Cassandra数据库系统是由多个节点组成的一个集群,有时也叫做环(ring)</p>
</li>
<li>
<p>keyspace :集群是keyspace的容器,里面通常只有一个keyspace</p>
<ul>
<li>可以针对keyspace设置的基本属性有一下几个</li>
<li>副本因子(Replication factor): 每行数据会被复制到多少个节点上</li>
<li>副本放置策略(Replica placement strategy): 副本如何放置到环上</li>
<li>列族 </li>
</ul>
</li>
<li>
<p>列族(column family): 容纳一组<em>有序行</em>的容器,每行都包含一组<em>有序</em>的列</p>
<ul>
<li>cassandra定义了列族但是没定义列,可以随意在任意列族中添加任意的列</li>
<li>列族有两个属性: 名称和比较器</li>
<li>向列族中写数据的时候，需要指定行键值(row key),类似于关系型数据库中的主键</li>
</ul>
</li>
<li>
<p>列(column): Cassandra数据模型中最基本的数据结构单元</p>
<ul>
<li>列由名称,值和时间戳组成的三元组,行没有时间戳,每个单独的列才有时间戳</li>
<li>Cassandra中不需要预先定义列,所有列的名字都是由客户端提供的</li>
<li>列的排序,Cassandra返回给客户端的结果可以指定列的名字如何进行比较和排序</li>
</ul>
</li>
</ul>
<h2>一致性级别</h2>
<ul>
<li>
<p>读一致性级别</p>
<ul>
<li><em>ONE</em>, 当一个节点响应查询时,立刻返回该响应的值.同时创建一个后台线程,检查这个记录的其他副本,
如果哪个副本已经过期了,接下来就会进行读时修复,以确保所有的副本都拥有最新的值</li>
<li><em>QUORUM</em>, 查询所有节点,当大部分副本((副本因子/2)+1)返回的时候,把时间戳最新的值返回,
之后在后台进行必要的读修复</li>
<li><em>ALL</em>, 查询所有节点,等待所有节点响应,并把时间戳最新的记录返回给客户端,之后进行必要的读修复.
如果有任何节点没有响应(响应超时时间由rpc<em>timeout</em>in_ms决定,默认是10秒),读操作都会失败</li>
</ul>
</li>
<li>
<p>写一致性级别</p>
<ul>
<li><em>ZERO</em> 在写数据被记录之前的返回,写操作将会在后台线程中异步完成,无法确保一定成功</li>
<li><em>ANY</em> 保证数据至少已经写到一个节点上了,提示(hint)也被看做是一个成功的写入</li>
<li><em>ONE</em> 保证在返回时,数据至少已经写入到一个节点的commit log和memtable中了</li>
<li><em>QUORUM</em> 保证多数副本((副本因子/2)+1)已经接收到数据</li>
<li><em>ALL</em> 保证在返回时副本因子指定数量的节点都接收到了数据.如果某个副本对写操作无响应,则写操作会失败</li>
</ul>
</li>
</ul>
<h2>Cassandra的架构</h2>
<ul>
<li>
<p>system keyspace</p>
<ul>
<li>名字为system的内部keyspace,无法手工修改</li>
<li>存储关于集群的原数据</li>
</ul>
</li>
<li>
<p>对等结构</p>
<ul>
<li>Cassandra没有主节点的概念,所有节点的地位都彼此相同</li>
<li>任意节点掉线只会影响系统的整体吞吐能力,不会中断服务</li>
<li>如果使用了合理的副本复制策略,故障节点上的所有数据仍然可以被读写</li>
</ul>
</li>
<li>
<p>gossip与故障检测</p>
<ul>
<li>Cassandra使用了gossip(流言)协议在进行环内通信,这样每个节点都会有其他节点的<strong>状态</strong>信息</li>
</ul>
</li>
<li>
<p>逆熵与读修复</p>
<ul>
<li>逆熵(anti-entropy)是Cassandra的副本同步机制,用于保障不同节点上的数据都更新到最新的版本</li>
<li>读取数据时,基于用户指定的一致性级别,一定数量的节点会被读取,在没有达到客户端指定的一致性级别前,
读操作是阻塞的.如果Cassandra检测到某些响应节点持有的是过时的数据,在数据返回之后,Cassandra
会在后台进行一个<strong>读修复</strong>的过程,用于更新过时的数据</li>
</ul>
</li>
<li>
<p>墓碑</p>
<ul>
<li>当你执行一个删除操作时,数据并不会被立刻删除,而会进行一个更新操作,在相应的值上面放一个墓碑</li>
<li>当执行压紧时,比墓碑更老的内容都会被清除,墓碑本身不会删除</li>
<li>垃圾回收时延,默认是10天.一旦墓碑的寿命超过这个时间,墓碑将会被删除.
设计这个时延的目的是留下足够长的时间以便于回复数据,如果一个节点的宕机时间超过这个时间点,那么应该被替换掉</li>
</ul>
</li>
</ul></div><hr data-reactid="27"/></div></div><div class="corner-container" style="display:none;" data-reactid="28"><button class="corner-button" type="button" data-reactid="29"><svg fill="currentColor" viewBox="0 0 24 24" width="24" height="24" data-reactid="30"><path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z" data-reactid="31"></path></svg></button></div></div></div><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'undefined', 'auto');
  ga('send', 'pageview');
      </script></body></html>